# DigitalOcean App Platform Spec for MoltBot
# This template is processed by the installer to substitute variables
# See: https://docs.digitalocean.com/products/app-platform/reference/app-spec/

name: ${APP_NAME}
region: ${REGION}

services:
  - name: moltbot
    # GitHub repository source
    github:
      repo: moltbot/moltbot
      branch: main
      deploy_on_push: false

    # Build from Dockerfile
    dockerfile_path: Dockerfile

    # Instance configuration
    instance_size_slug: basic-xxs  # $5/mo, 512MB RAM, 1 vCPU
    instance_count: 1

    # HTTP configuration
    http_port: 3000

    # Health check
    health_check:
      http_path: /health
      initial_delay_seconds: 30
      period_seconds: 30

    # Environment variables
    envs:
      # AI Provider API Key
      - key: ${API_KEY_NAME}
        value: "${API_KEY}"
        type: SECRET

      # Gateway authentication token
      - key: CLAWDBOT_GATEWAY_TOKEN
        value: "${GATEWAY_TOKEN}"
        type: SECRET

      # MoltBot configuration as base64-encoded JSON
      # The entrypoint script will decode this and write to /data/moltbot.json
      - key: MOLTBOT_CONFIG_BASE64
        value: "${MOLTBOT_CONFIG_BASE64}"
        type: SECRET

      # Node environment
      - key: NODE_ENV
        value: "production"

      # Data directory (for persistent storage)
      - key: MOLTBOT_DATA_DIR
        value: "/data"

    # Routes
    routes:
      - path: /

# Optional: Managed database for persistent storage
# Uncomment if you need persistent storage beyond environment variables
# databases:
#   - name: moltbot-db
#     engine: PG
#     version: "15"
#     size: db-s-dev-database  # $7/mo
