# MoltBot Fly.io deployment configuration
# Documentation: https://docs.molt.bot/platforms/fly

# ============================================================================
# CHANGE THESE VALUES
# ============================================================================

app = "your-app-name"      # <-- CHANGE THIS to your unique app name
primary_region = "iad"     # <-- CHANGE THIS to your closest region
                           # Options: iad (Virginia), sjc (San Jose), lhr (London),
                           #          gru (Sao Paulo), nrt (Tokyo)

# ============================================================================
# Build configuration
# ============================================================================

[build]
  dockerfile = "Dockerfile"

# ============================================================================
# Environment variables
# ============================================================================

[env]
  NODE_ENV = "production"
  CLAWDBOT_PREFER_PNPM = "1"
  CLAWDBOT_STATE_DIR = "/data"
  NODE_OPTIONS = "--max-old-space-size=3584"  # ~3.5GB for 4GB VM

# ============================================================================
# Process configuration
# ============================================================================

[processes]
  app = "node dist/index.js gateway --allow-unconfigured --port 3000 --bind lan"

# ============================================================================
# HTTP service (public URL)
# ============================================================================

[http_service]
  internal_port = 3000
  force_https = true
  auto_stop_machines = false  # Keep running for persistent connections
  auto_start_machines = true
  min_machines_running = 1
  processes = ["app"]

# ============================================================================
# VM resources - 4GB RAM recommended to avoid OOM errors
# ============================================================================

[[vm]]
  size = "shared-cpu-2x"
  memory = "4096mb"  # 4GB - do not reduce, 2GB causes OOM errors

# ============================================================================
# Persistent storage
# ============================================================================

[mounts]
  source = "moltbot_data"
  destination = "/data"
